{"ast":null,"code":"var _jsxFileName = \"/Users/davidmunechika/Documents/Code/Research/visual-auditor/visual-auditor-package/src/components/Main/SliceBarChart.js\",\n    _s = $RefreshSig$();\n\nimport { useD3 } from '../../hooks/useD3';\nimport React, { memo } from 'react';\nimport * as d3 from 'd3';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction SliceBarChart({\n  data,\n  model,\n  max,\n  overperforming,\n  metric,\n  setDetails\n}) {\n  _s();\n\n  const [selected, setSelected] = React.useState(null);\n  const [doneAnimating, setDoneAnimating] = React.useState(false);\n  React.useEffect(() => {\n    setDoneAnimating(false);\n  }, [data]);\n  const ref = useD3(svg => {\n    const height = 600;\n    const width = 875;\n    const margin = {\n      top: 20,\n      right: 30,\n      bottom: 50,\n      left: 90\n    };\n    let div = d3.select('.tooltip').style('opacity', 0).style('width', '200px').style('height', '200px').style('padding', '1rem 0.5rem 0 0.5rem').style('border-radius', '20px');\n    const x = d3.scaleBand().domain(data.map(d => d.slice)).rangeRound([margin.left, width - margin.right]).padding(0.1);\n    const y1 = d3.scaleLinear().domain([0, max]).rangeRound([height - margin.bottom, margin.top]);\n\n    const xAxis = g => g.attr('transform', `translate(0,${height - margin.bottom})`).call(d3.axisBottom(x).tickSizeOuter(0)).selectAll('text').attr('transform', 'translate(-10,0)rotate(-45)').style('text-anchor', 'end');\n\n    const y1Axis = g => g.attr('transform', `translate(${margin.left},0)`).style('color', 'steelblue').call(d3.axisLeft(y1).ticks(null, 's')).call(g => g.select('.domain').remove()).call(g => g.append('text').attr('x', -margin.left).attr('y', 10).attr('fill', 'currentColor').attr('text-anchor', 'start').text(data.y1));\n\n    svg.select('.x-axis').call(xAxis);\n    svg.select('.y-axis').call(y1Axis);\n    svg.select('.plot-area').selectAll('.bar').data(data).join('rect').attr('class', 'bar').attr(\"style\", d => {\n      if (d.slice === selected) {\n        return \"outline: 3px solid #FFD600;\";\n      }\n    }).style('fill', d => {\n      // if (d.slice === selected) {\n      //   return d3.interpolateGreys(0.5);\n      // }\n      if (overperforming) return d3.interpolateBlues(Math.abs((d.metric - model) / model));\n      return d3.interpolateReds(Math.abs((d.metric - model) / model));\n    }).on('mouseover', function (event, d) {\n      d3.select(this).style('opacity', '0.7').style('cursor', 'pointer');\n      div.transition().duration(200).style('opacity', 0.9).style('left', width / 2 + 'px').style('top', height / 4 + 'px');\n      div.html('<strong>Slice Description: </strong>' + '<br><div style={{margin: \"1rem\"}}> </div>' + d.slice + '<br>' + '<strong>Size: </strong>' + '<br>' + d.size + ' samples' + '<br>' + '<strong>Metric: </strong>' + '<br>' + d.metric.toFixed(2) + '<br>' + `(${Math.round((d.metric - model) / model * 100)}% difference)`);\n    }).on('mouseout', function (d) {\n      d3.select(this).style('opacity', '1');\n      div.transition().style('opacity', 0).style('left', width + 'px').style('top', 0 + 'px');\n    }).on('click', function (event, d) {\n      setSelected(d.slice);\n      setDetails({\n        slice: d.slice,\n        size: d.size,\n        metric: d.metric,\n        similarSlices: []\n      });\n    }).attr('x', d => x(d.slice)).attr('width', x.bandwidth()).attr('y', d => y1(0) - margin.bottom).attr('height', d => height - y1(0)); // Animation\n\n    if (!doneAnimating) {\n      svg.selectAll('rect').transition().duration(800).attr('y', function (d) {\n        return y1(d.metric) - margin.bottom;\n      }).attr('height', function (d) {\n        return height - y1(d.metric);\n      }).delay(function (d, i) {\n        return i * 100;\n      });\n      setDoneAnimating(true);\n    } else {\n      svg.selectAll('rect').attr('y', function (d) {\n        return y1(d.metric) - margin.bottom;\n      }).attr('height', function (d) {\n        return height - y1(d.metric);\n      });\n    }\n\n    svg.selectAll('.line').remove();\n    svg.selectAll('.label').remove();\n    svg.append('svg:line').attr('class', 'line').attr('x1', 60).attr('x2', width).attr('y1', y1(model)).attr('y2', y1(model)).style('stroke', '#e6e6e6');\n    svg.append('text').attr('class', 'label').text('Model').attr('x', 0).attr('y', y1(model) + 5).style('fill', 'gray');\n    svg.append('text').attr('class', 'label').text(metric).attr('x', 0).attr('y', y1(model) + 25).style('fill', 'gray');\n  }, [data, metric, selected]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"tooltip\",\n      style: {\n        position: 'absolute',\n        background: 'lightgray'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: ref,\n      style: {\n        height: 700,\n        width: '60%',\n        margin: 'auto',\n        display: 'block'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"g\", {\n        className: \"plot-area\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"g\", {\n        className: \"x-axis\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"g\", {\n        className: \"y-axis\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"g\", {\n        className: \"label\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 194,\n    columnNumber: 5\n  }, this);\n}\n\n_s(SliceBarChart, \"nFL8CBx43ZquM8/8yB3m+xl/fPU=\", false, function () {\n  return [useD3];\n});\n\n_c = SliceBarChart;\nexport default _c2 = /*#__PURE__*/memo(SliceBarChart);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"SliceBarChart\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/davidmunechika/Documents/Code/Research/visual-auditor/visual-auditor-package/src/components/Main/SliceBarChart.js"],"names":["useD3","React","memo","d3","SliceBarChart","data","model","max","overperforming","metric","setDetails","selected","setSelected","useState","doneAnimating","setDoneAnimating","useEffect","ref","svg","height","width","margin","top","right","bottom","left","div","select","style","x","scaleBand","domain","map","d","slice","rangeRound","padding","y1","scaleLinear","xAxis","g","attr","call","axisBottom","tickSizeOuter","selectAll","y1Axis","axisLeft","ticks","remove","append","text","join","interpolateBlues","Math","abs","interpolateReds","on","event","transition","duration","html","size","toFixed","round","similarSlices","bandwidth","delay","i","position","background","display"],"mappings":"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","sourcesContent":["import { useD3 } from '../../hooks/useD3';\nimport React, { memo } from 'react';\nimport * as d3 from 'd3';\n\nfunction SliceBarChart({\n  data,\n  model,\n  max,\n  overperforming,\n  metric,\n  setDetails,\n}) {\n  const [selected, setSelected] = React.useState(null);\n  const [doneAnimating, setDoneAnimating] = React.useState(false);\n  React.useEffect(() => {\n    setDoneAnimating(false);\n  }, [data]);\n\n  const ref = useD3(\n    (svg) => {\n      const height = 600;\n      const width = 875;\n      const margin = { top: 20, right: 30, bottom: 50, left: 90 };\n\n      let div = d3\n        .select('.tooltip')\n        .style('opacity', 0)\n        .style('width', '200px')\n        .style('height', '200px')\n        .style('padding', '1rem 0.5rem 0 0.5rem')\n        .style('border-radius', '20px');\n\n      const x = d3\n        .scaleBand()\n        .domain(data.map((d) => d.slice))\n        .rangeRound([margin.left, width - margin.right])\n        .padding(0.1);\n\n      const y1 = d3\n        .scaleLinear()\n        .domain([0, max])\n        .rangeRound([height - margin.bottom, margin.top]);\n\n      const xAxis = (g) =>\n        g\n          .attr('transform', `translate(0,${height - margin.bottom})`)\n          .call(d3.axisBottom(x).tickSizeOuter(0))\n          .selectAll('text')\n          .attr('transform', 'translate(-10,0)rotate(-45)')\n          .style('text-anchor', 'end');\n\n      const y1Axis = (g) =>\n        g\n          .attr('transform', `translate(${margin.left},0)`)\n          .style('color', 'steelblue')\n          .call(d3.axisLeft(y1).ticks(null, 's'))\n          .call((g) => g.select('.domain').remove())\n          .call((g) =>\n            g\n              .append('text')\n              .attr('x', -margin.left)\n              .attr('y', 10)\n              .attr('fill', 'currentColor')\n              .attr('text-anchor', 'start')\n              .text(data.y1)\n          );\n\n      svg.select('.x-axis').call(xAxis);\n      svg.select('.y-axis').call(y1Axis);\n\n      svg\n        .select('.plot-area')\n        .selectAll('.bar')\n        .data(data)\n        .join('rect')\n        .attr('class', 'bar')\n        .attr(\"style\", (d) => {\n          if (d.slice === selected) {\n            return \"outline: 3px solid #FFD600;\"\n          }\n        })\n        .style('fill', (d) => {\n          // if (d.slice === selected) {\n          //   return d3.interpolateGreys(0.5);\n          // }\n          if (overperforming)\n            return d3.interpolateBlues(Math.abs((d.metric - model) / model));\n          return d3.interpolateReds(Math.abs((d.metric - model) / model));\n        })\n        .on('mouseover', function (event, d) {\n          d3.select(this).style('opacity', '0.7').style('cursor', 'pointer');\n          div\n            .transition()\n            .duration(200)\n            .style('opacity', 0.9)\n            .style('left', width / 2 + 'px')\n            .style('top', height / 4 + 'px');\n          div.html(\n            '<strong>Slice Description: </strong>' +\n              '<br><div style={{margin: \"1rem\"}}> </div>' +\n              d.slice +\n              '<br>' +\n              '<strong>Size: </strong>' +\n              '<br>' +\n              d.size +\n              ' samples' +\n              '<br>' +\n              '<strong>Metric: </strong>' +\n              '<br>' +\n              d.metric.toFixed(2) +\n              '<br>' +\n              `(${Math.round(((d.metric - model) / model) * 100)}% difference)`\n          );\n        })\n        .on('mouseout', function (d) {\n          d3.select(this).style('opacity', '1');\n          div\n            .transition()\n            .style('opacity', 0)\n            .style('left', width + 'px')\n            .style('top', 0 + 'px');\n        })\n        .on('click', function (event, d) {\n          setSelected(d.slice);\n          setDetails({\n            slice: d.slice,\n            size: d.size,\n            metric: d.metric,\n            similarSlices: [],\n          });\n        })\n        .attr('x', (d) => x(d.slice))\n        .attr('width', x.bandwidth())\n        .attr('y', (d) => y1(0) - margin.bottom)\n        .attr('height', (d) => height - y1(0));\n\n      // Animation\n      if (!doneAnimating) {\n        svg\n          .selectAll('rect')\n          .transition()\n          .duration(800)\n          .attr('y', function (d) {\n            return y1(d.metric) - margin.bottom;\n          })\n          .attr('height', function (d) {\n            return height - y1(d.metric);\n          })\n          .delay(function (d, i) {\n            return i * 100;\n          });\n        setDoneAnimating(true);\n      } else {\n        svg\n          .selectAll('rect')\n          .attr('y', function (d) {\n            return y1(d.metric) - margin.bottom;\n          })\n          .attr('height', function (d) {\n            return height - y1(d.metric);\n          });\n      }\n\n      svg.selectAll('.line').remove();\n      svg.selectAll('.label').remove();\n\n      svg\n        .append('svg:line')\n        .attr('class', 'line')\n        .attr('x1', 60)\n        .attr('x2', width)\n        .attr('y1', y1(model))\n        .attr('y2', y1(model))\n        .style('stroke', '#e6e6e6');\n      svg\n        .append('text')\n        .attr('class', 'label')\n        .text('Model')\n        .attr('x', 0)\n        .attr('y', y1(model) + 5)\n        .style('fill', 'gray');\n      svg\n        .append('text')\n        .attr('class', 'label')\n        .text(metric)\n        .attr('x', 0)\n        .attr('y', y1(model) + 25)\n        .style('fill', 'gray');\n    },\n    [data, metric, selected]\n  );\n\n  return (\n    <div>\n      <div\n        className='tooltip'\n        style={{ position: 'absolute', background: 'lightgray' }}\n      ></div>\n      <svg\n        ref={ref}\n        style={{\n          height: 700,\n          width: '60%',\n          margin: 'auto',\n          display: 'block',\n        }}\n      >\n        <g className='plot-area' />\n        <g className='x-axis' />\n        <g className='y-axis' />\n        <g className='label' />\n      </svg>\n    </div>\n  );\n}\n\nexport default memo(SliceBarChart);\n"]},"metadata":{},"sourceType":"module"}