{"ast":null,"code":"import { dispatch } from \"d3-dispatch\";\nimport { select, pointer } from \"d3-selection\";\nimport nodrag, { yesdrag } from \"./nodrag.js\";\nimport noevent, { nonpassive, nonpassivecapture, nopropagation } from \"./noevent.js\";\nimport constant from \"./constant.js\";\nimport DragEvent from \"./event.js\"; // Ignore right-click, since that should open the context menu.\n\nfunction defaultFilter(event) {\n  return !event.ctrlKey && !event.button;\n}\n\nfunction defaultContainer() {\n  return this.parentNode;\n}\n\nfunction defaultSubject(event, d) {\n  return d == null ? {\n    x: event.x,\n    y: event.y\n  } : d;\n}\n\nfunction defaultTouchable() {\n  return navigator.maxTouchPoints || \"ontouchstart\" in this;\n}\n\nexport default function () {\n  var filter = defaultFilter,\n      container = defaultContainer,\n      subject = defaultSubject,\n      touchable = defaultTouchable,\n      gestures = {},\n      listeners = dispatch(\"start\", \"drag\", \"end\"),\n      active = 0,\n      mousedownx,\n      mousedowny,\n      mousemoving,\n      touchending,\n      clickDistance2 = 0;\n\n  function drag(selection) {\n    selection.on(\"mousedown.drag\", mousedowned).filter(touchable).on(\"touchstart.drag\", touchstarted).on(\"touchmove.drag\", touchmoved, nonpassive).on(\"touchend.drag touchcancel.drag\", touchended).style(\"touch-action\", \"none\").style(\"-webkit-tap-highlight-color\", \"rgba(0,0,0,0)\");\n  }\n\n  function mousedowned(event, d) {\n    if (touchending || !filter.call(this, event, d)) return;\n    var gesture = beforestart(this, container.call(this, event, d), event, d, \"mouse\");\n    if (!gesture) return;\n    select(event.view).on(\"mousemove.drag\", mousemoved, nonpassivecapture).on(\"mouseup.drag\", mouseupped, nonpassivecapture);\n    nodrag(event.view);\n    nopropagation(event);\n    mousemoving = false;\n    mousedownx = event.clientX;\n    mousedowny = event.clientY;\n    gesture(\"start\", event);\n  }\n\n  function mousemoved(event) {\n    noevent(event);\n\n    if (!mousemoving) {\n      var dx = event.clientX - mousedownx,\n          dy = event.clientY - mousedowny;\n      mousemoving = dx * dx + dy * dy > clickDistance2;\n    }\n\n    gestures.mouse(\"drag\", event);\n  }\n\n  function mouseupped(event) {\n    select(event.view).on(\"mousemove.drag mouseup.drag\", null);\n    yesdrag(event.view, mousemoving);\n    noevent(event);\n    gestures.mouse(\"end\", event);\n  }\n\n  function touchstarted(event, d) {\n    if (!filter.call(this, event, d)) return;\n    var touches = event.changedTouches,\n        c = container.call(this, event, d),\n        n = touches.length,\n        i,\n        gesture;\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = beforestart(this, c, event, d, touches[i].identifier, touches[i])) {\n        nopropagation(event);\n        gesture(\"start\", event, touches[i]);\n      }\n    }\n  }\n\n  function touchmoved(event) {\n    var touches = event.changedTouches,\n        n = touches.length,\n        i,\n        gesture;\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = gestures[touches[i].identifier]) {\n        noevent(event);\n        gesture(\"drag\", event, touches[i]);\n      }\n    }\n  }\n\n  function touchended(event) {\n    var touches = event.changedTouches,\n        n = touches.length,\n        i,\n        gesture;\n    if (touchending) clearTimeout(touchending);\n    touchending = setTimeout(function () {\n      touchending = null;\n    }, 500); // Ghost clicks are delayed!\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = gestures[touches[i].identifier]) {\n        nopropagation(event);\n        gesture(\"end\", event, touches[i]);\n      }\n    }\n  }\n\n  function beforestart(that, container, event, d, identifier, touch) {\n    var dispatch = listeners.copy(),\n        p = pointer(touch || event, container),\n        dx,\n        dy,\n        s;\n    if ((s = subject.call(that, new DragEvent(\"beforestart\", {\n      sourceEvent: event,\n      target: drag,\n      identifier,\n      active,\n      x: p[0],\n      y: p[1],\n      dx: 0,\n      dy: 0,\n      dispatch\n    }), d)) == null) return;\n    dx = s.x - p[0] || 0;\n    dy = s.y - p[1] || 0;\n    return function gesture(type, event, touch) {\n      var p0 = p,\n          n;\n\n      switch (type) {\n        case \"start\":\n          gestures[identifier] = gesture, n = active++;\n          break;\n\n        case \"end\":\n          delete gestures[identifier], --active;\n        // falls through\n\n        case \"drag\":\n          p = pointer(touch || event, container), n = active;\n          break;\n      }\n\n      dispatch.call(type, that, new DragEvent(type, {\n        sourceEvent: event,\n        subject: s,\n        target: drag,\n        identifier,\n        active: n,\n        x: p[0] + dx,\n        y: p[1] + dy,\n        dx: p[0] - p0[0],\n        dy: p[1] - p0[1],\n        dispatch\n      }), d);\n    };\n  }\n\n  drag.filter = function (_) {\n    return arguments.length ? (filter = typeof _ === \"function\" ? _ : constant(!!_), drag) : filter;\n  };\n\n  drag.container = function (_) {\n    return arguments.length ? (container = typeof _ === \"function\" ? _ : constant(_), drag) : container;\n  };\n\n  drag.subject = function (_) {\n    return arguments.length ? (subject = typeof _ === \"function\" ? _ : constant(_), drag) : subject;\n  };\n\n  drag.touchable = function (_) {\n    return arguments.length ? (touchable = typeof _ === \"function\" ? _ : constant(!!_), drag) : touchable;\n  };\n\n  drag.on = function () {\n    var value = listeners.on.apply(listeners, arguments);\n    return value === listeners ? drag : value;\n  };\n\n  drag.clickDistance = function (_) {\n    return arguments.length ? (clickDistance2 = (_ = +_) * _, drag) : Math.sqrt(clickDistance2);\n  };\n\n  return drag;\n}","map":{"version":3,"sources":["/Users/davidmunechika/Documents/Code/Research/visual-auditor/visual-auditor-package/node_modules/d3-drag/src/drag.js"],"names":["dispatch","select","pointer","nodrag","yesdrag","noevent","nonpassive","nonpassivecapture","nopropagation","constant","DragEvent","defaultFilter","event","ctrlKey","button","defaultContainer","parentNode","defaultSubject","d","x","y","defaultTouchable","navigator","maxTouchPoints","filter","container","subject","touchable","gestures","listeners","active","mousedownx","mousedowny","mousemoving","touchending","clickDistance2","drag","selection","on","mousedowned","touchstarted","touchmoved","touchended","style","call","gesture","beforestart","view","mousemoved","mouseupped","clientX","clientY","dx","dy","mouse","touches","changedTouches","c","n","length","i","identifier","clearTimeout","setTimeout","that","touch","copy","p","s","sourceEvent","target","type","p0","_","arguments","value","apply","clickDistance","Math","sqrt"],"mappings":"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","sourcesContent":["import {dispatch} from \"d3-dispatch\";\nimport {select, pointer} from \"d3-selection\";\nimport nodrag, {yesdrag} from \"./nodrag.js\";\nimport noevent, {nonpassive, nonpassivecapture, nopropagation} from \"./noevent.js\";\nimport constant from \"./constant.js\";\nimport DragEvent from \"./event.js\";\n\n// Ignore right-click, since that should open the context menu.\nfunction defaultFilter(event) {\n  return !event.ctrlKey && !event.button;\n}\n\nfunction defaultContainer() {\n  return this.parentNode;\n}\n\nfunction defaultSubject(event, d) {\n  return d == null ? {x: event.x, y: event.y} : d;\n}\n\nfunction defaultTouchable() {\n  return navigator.maxTouchPoints || (\"ontouchstart\" in this);\n}\n\nexport default function() {\n  var filter = defaultFilter,\n      container = defaultContainer,\n      subject = defaultSubject,\n      touchable = defaultTouchable,\n      gestures = {},\n      listeners = dispatch(\"start\", \"drag\", \"end\"),\n      active = 0,\n      mousedownx,\n      mousedowny,\n      mousemoving,\n      touchending,\n      clickDistance2 = 0;\n\n  function drag(selection) {\n    selection\n        .on(\"mousedown.drag\", mousedowned)\n      .filter(touchable)\n        .on(\"touchstart.drag\", touchstarted)\n        .on(\"touchmove.drag\", touchmoved, nonpassive)\n        .on(\"touchend.drag touchcancel.drag\", touchended)\n        .style(\"touch-action\", \"none\")\n        .style(\"-webkit-tap-highlight-color\", \"rgba(0,0,0,0)\");\n  }\n\n  function mousedowned(event, d) {\n    if (touchending || !filter.call(this, event, d)) return;\n    var gesture = beforestart(this, container.call(this, event, d), event, d, \"mouse\");\n    if (!gesture) return;\n    select(event.view)\n      .on(\"mousemove.drag\", mousemoved, nonpassivecapture)\n      .on(\"mouseup.drag\", mouseupped, nonpassivecapture);\n    nodrag(event.view);\n    nopropagation(event);\n    mousemoving = false;\n    mousedownx = event.clientX;\n    mousedowny = event.clientY;\n    gesture(\"start\", event);\n  }\n\n  function mousemoved(event) {\n    noevent(event);\n    if (!mousemoving) {\n      var dx = event.clientX - mousedownx, dy = event.clientY - mousedowny;\n      mousemoving = dx * dx + dy * dy > clickDistance2;\n    }\n    gestures.mouse(\"drag\", event);\n  }\n\n  function mouseupped(event) {\n    select(event.view).on(\"mousemove.drag mouseup.drag\", null);\n    yesdrag(event.view, mousemoving);\n    noevent(event);\n    gestures.mouse(\"end\", event);\n  }\n\n  function touchstarted(event, d) {\n    if (!filter.call(this, event, d)) return;\n    var touches = event.changedTouches,\n        c = container.call(this, event, d),\n        n = touches.length, i, gesture;\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = beforestart(this, c, event, d, touches[i].identifier, touches[i])) {\n        nopropagation(event);\n        gesture(\"start\", event, touches[i]);\n      }\n    }\n  }\n\n  function touchmoved(event) {\n    var touches = event.changedTouches,\n        n = touches.length, i, gesture;\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = gestures[touches[i].identifier]) {\n        noevent(event);\n        gesture(\"drag\", event, touches[i]);\n      }\n    }\n  }\n\n  function touchended(event) {\n    var touches = event.changedTouches,\n        n = touches.length, i, gesture;\n\n    if (touchending) clearTimeout(touchending);\n    touchending = setTimeout(function() { touchending = null; }, 500); // Ghost clicks are delayed!\n    for (i = 0; i < n; ++i) {\n      if (gesture = gestures[touches[i].identifier]) {\n        nopropagation(event);\n        gesture(\"end\", event, touches[i]);\n      }\n    }\n  }\n\n  function beforestart(that, container, event, d, identifier, touch) {\n    var dispatch = listeners.copy(),\n        p = pointer(touch || event, container), dx, dy,\n        s;\n\n    if ((s = subject.call(that, new DragEvent(\"beforestart\", {\n        sourceEvent: event,\n        target: drag,\n        identifier,\n        active,\n        x: p[0],\n        y: p[1],\n        dx: 0,\n        dy: 0,\n        dispatch\n      }), d)) == null) return;\n\n    dx = s.x - p[0] || 0;\n    dy = s.y - p[1] || 0;\n\n    return function gesture(type, event, touch) {\n      var p0 = p, n;\n      switch (type) {\n        case \"start\": gestures[identifier] = gesture, n = active++; break;\n        case \"end\": delete gestures[identifier], --active; // falls through\n        case \"drag\": p = pointer(touch || event, container), n = active; break;\n      }\n      dispatch.call(\n        type,\n        that,\n        new DragEvent(type, {\n          sourceEvent: event,\n          subject: s,\n          target: drag,\n          identifier,\n          active: n,\n          x: p[0] + dx,\n          y: p[1] + dy,\n          dx: p[0] - p0[0],\n          dy: p[1] - p0[1],\n          dispatch\n        }),\n        d\n      );\n    };\n  }\n\n  drag.filter = function(_) {\n    return arguments.length ? (filter = typeof _ === \"function\" ? _ : constant(!!_), drag) : filter;\n  };\n\n  drag.container = function(_) {\n    return arguments.length ? (container = typeof _ === \"function\" ? _ : constant(_), drag) : container;\n  };\n\n  drag.subject = function(_) {\n    return arguments.length ? (subject = typeof _ === \"function\" ? _ : constant(_), drag) : subject;\n  };\n\n  drag.touchable = function(_) {\n    return arguments.length ? (touchable = typeof _ === \"function\" ? _ : constant(!!_), drag) : touchable;\n  };\n\n  drag.on = function() {\n    var value = listeners.on.apply(listeners, arguments);\n    return value === listeners ? drag : value;\n  };\n\n  drag.clickDistance = function(_) {\n    return arguments.length ? (clickDistance2 = (_ = +_) * _, drag) : Math.sqrt(clickDistance2);\n  };\n\n  return drag;\n}\n"]},"metadata":{},"sourceType":"module"}