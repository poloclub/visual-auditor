{"ast":null,"code":"import { quadtree } from \"d3-quadtree\";\nimport constant from \"./constant.js\";\nimport jiggle from \"./jiggle.js\";\nimport { x, y } from \"./simulation.js\";\nexport default function () {\n  var nodes,\n      node,\n      random,\n      alpha,\n      strength = constant(-30),\n      strengths,\n      distanceMin2 = 1,\n      distanceMax2 = Infinity,\n      theta2 = 0.81;\n\n  function force(_) {\n    var i,\n        n = nodes.length,\n        tree = quadtree(nodes, x, y).visitAfter(accumulate);\n\n    for (alpha = _, i = 0; i < n; ++i) node = nodes[i], tree.visit(apply);\n  }\n\n  function initialize() {\n    if (!nodes) return;\n    var i,\n        n = nodes.length,\n        node;\n    strengths = new Array(n);\n\n    for (i = 0; i < n; ++i) node = nodes[i], strengths[node.index] = +strength(node, i, nodes);\n  }\n\n  function accumulate(quad) {\n    var strength = 0,\n        q,\n        c,\n        weight = 0,\n        x,\n        y,\n        i; // For internal nodes, accumulate forces from child quadrants.\n\n    if (quad.length) {\n      for (x = y = i = 0; i < 4; ++i) {\n        if ((q = quad[i]) && (c = Math.abs(q.value))) {\n          strength += q.value, weight += c, x += c * q.x, y += c * q.y;\n        }\n      }\n\n      quad.x = x / weight;\n      quad.y = y / weight;\n    } // For leaf nodes, accumulate forces from coincident quadrants.\n    else {\n      q = quad;\n      q.x = q.data.x;\n      q.y = q.data.y;\n\n      do strength += strengths[q.data.index]; while (q = q.next);\n    }\n\n    quad.value = strength;\n  }\n\n  function apply(quad, x1, _, x2) {\n    if (!quad.value) return true;\n    var x = quad.x - node.x,\n        y = quad.y - node.y,\n        w = x2 - x1,\n        l = x * x + y * y; // Apply the Barnes-Hut approximation if possible.\n    // Limit forces for very close nodes; randomize direction if coincident.\n\n    if (w * w / theta2 < l) {\n      if (l < distanceMax2) {\n        if (x === 0) x = jiggle(random), l += x * x;\n        if (y === 0) y = jiggle(random), l += y * y;\n        if (l < distanceMin2) l = Math.sqrt(distanceMin2 * l);\n        node.vx += x * quad.value * alpha / l;\n        node.vy += y * quad.value * alpha / l;\n      }\n\n      return true;\n    } // Otherwise, process points directly.\n    else if (quad.length || l >= distanceMax2) return; // Limit forces for very close nodes; randomize direction if coincident.\n\n\n    if (quad.data !== node || quad.next) {\n      if (x === 0) x = jiggle(random), l += x * x;\n      if (y === 0) y = jiggle(random), l += y * y;\n      if (l < distanceMin2) l = Math.sqrt(distanceMin2 * l);\n    }\n\n    do if (quad.data !== node) {\n      w = strengths[quad.data.index] * alpha / l;\n      node.vx += x * w;\n      node.vy += y * w;\n    } while (quad = quad.next);\n  }\n\n  force.initialize = function (_nodes, _random) {\n    nodes = _nodes;\n    random = _random;\n    initialize();\n  };\n\n  force.strength = function (_) {\n    return arguments.length ? (strength = typeof _ === \"function\" ? _ : constant(+_), initialize(), force) : strength;\n  };\n\n  force.distanceMin = function (_) {\n    return arguments.length ? (distanceMin2 = _ * _, force) : Math.sqrt(distanceMin2);\n  };\n\n  force.distanceMax = function (_) {\n    return arguments.length ? (distanceMax2 = _ * _, force) : Math.sqrt(distanceMax2);\n  };\n\n  force.theta = function (_) {\n    return arguments.length ? (theta2 = _ * _, force) : Math.sqrt(theta2);\n  };\n\n  return force;\n}","map":{"version":3,"sources":["/Users/davidmunechika/Documents/Code/Research/visual-auditor/node_modules/d3-force/src/manyBody.js"],"names":["quadtree","constant","jiggle","x","y","nodes","node","random","alpha","strength","strengths","distanceMin2","distanceMax2","Infinity","theta2","force","_","i","n","length","tree","visitAfter","accumulate","visit","apply","initialize","Array","index","quad","q","c","weight","Math","abs","value","data","next","x1","x2","w","l","sqrt","vx","vy","_nodes","_random","arguments","distanceMin","distanceMax","theta"],"mappings":"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","sourcesContent":["import {quadtree} from \"d3-quadtree\";\nimport constant from \"./constant.js\";\nimport jiggle from \"./jiggle.js\";\nimport {x, y} from \"./simulation.js\";\n\nexport default function() {\n  var nodes,\n      node,\n      random,\n      alpha,\n      strength = constant(-30),\n      strengths,\n      distanceMin2 = 1,\n      distanceMax2 = Infinity,\n      theta2 = 0.81;\n\n  function force(_) {\n    var i, n = nodes.length, tree = quadtree(nodes, x, y).visitAfter(accumulate);\n    for (alpha = _, i = 0; i < n; ++i) node = nodes[i], tree.visit(apply);\n  }\n\n  function initialize() {\n    if (!nodes) return;\n    var i, n = nodes.length, node;\n    strengths = new Array(n);\n    for (i = 0; i < n; ++i) node = nodes[i], strengths[node.index] = +strength(node, i, nodes);\n  }\n\n  function accumulate(quad) {\n    var strength = 0, q, c, weight = 0, x, y, i;\n\n    // For internal nodes, accumulate forces from child quadrants.\n    if (quad.length) {\n      for (x = y = i = 0; i < 4; ++i) {\n        if ((q = quad[i]) && (c = Math.abs(q.value))) {\n          strength += q.value, weight += c, x += c * q.x, y += c * q.y;\n        }\n      }\n      quad.x = x / weight;\n      quad.y = y / weight;\n    }\n\n    // For leaf nodes, accumulate forces from coincident quadrants.\n    else {\n      q = quad;\n      q.x = q.data.x;\n      q.y = q.data.y;\n      do strength += strengths[q.data.index];\n      while (q = q.next);\n    }\n\n    quad.value = strength;\n  }\n\n  function apply(quad, x1, _, x2) {\n    if (!quad.value) return true;\n\n    var x = quad.x - node.x,\n        y = quad.y - node.y,\n        w = x2 - x1,\n        l = x * x + y * y;\n\n    // Apply the Barnes-Hut approximation if possible.\n    // Limit forces for very close nodes; randomize direction if coincident.\n    if (w * w / theta2 < l) {\n      if (l < distanceMax2) {\n        if (x === 0) x = jiggle(random), l += x * x;\n        if (y === 0) y = jiggle(random), l += y * y;\n        if (l < distanceMin2) l = Math.sqrt(distanceMin2 * l);\n        node.vx += x * quad.value * alpha / l;\n        node.vy += y * quad.value * alpha / l;\n      }\n      return true;\n    }\n\n    // Otherwise, process points directly.\n    else if (quad.length || l >= distanceMax2) return;\n\n    // Limit forces for very close nodes; randomize direction if coincident.\n    if (quad.data !== node || quad.next) {\n      if (x === 0) x = jiggle(random), l += x * x;\n      if (y === 0) y = jiggle(random), l += y * y;\n      if (l < distanceMin2) l = Math.sqrt(distanceMin2 * l);\n    }\n\n    do if (quad.data !== node) {\n      w = strengths[quad.data.index] * alpha / l;\n      node.vx += x * w;\n      node.vy += y * w;\n    } while (quad = quad.next);\n  }\n\n  force.initialize = function(_nodes, _random) {\n    nodes = _nodes;\n    random = _random;\n    initialize();\n  };\n\n  force.strength = function(_) {\n    return arguments.length ? (strength = typeof _ === \"function\" ? _ : constant(+_), initialize(), force) : strength;\n  };\n\n  force.distanceMin = function(_) {\n    return arguments.length ? (distanceMin2 = _ * _, force) : Math.sqrt(distanceMin2);\n  };\n\n  force.distanceMax = function(_) {\n    return arguments.length ? (distanceMax2 = _ * _, force) : Math.sqrt(distanceMax2);\n  };\n\n  force.theta = function(_) {\n    return arguments.length ? (theta2 = _ * _, force) : Math.sqrt(theta2);\n  };\n\n  return force;\n}\n"]},"metadata":{},"sourceType":"module"}