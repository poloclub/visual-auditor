{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/davidmunechika/Documents/Code/Research/visual-auditor/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport { dispatch } from \"d3-dispatch\";\nimport { dragDisable, dragEnable } from \"d3-drag\";\nimport { interpolate } from \"d3-interpolate\";\nimport { pointer, select } from \"d3-selection\";\nimport { interrupt } from \"d3-transition\";\nimport constant from \"./constant.js\";\nimport BrushEvent from \"./event.js\";\nimport noevent, { nopropagation } from \"./noevent.js\";\nvar MODE_DRAG = {\n  name: \"drag\"\n},\n    MODE_SPACE = {\n  name: \"space\"\n},\n    MODE_HANDLE = {\n  name: \"handle\"\n},\n    MODE_CENTER = {\n  name: \"center\"\n};\nvar abs = Math.abs,\n    max = Math.max,\n    min = Math.min;\n\nfunction number1(e) {\n  return [+e[0], +e[1]];\n}\n\nfunction number2(e) {\n  return [number1(e[0]), number1(e[1])];\n}\n\nvar X = {\n  name: \"x\",\n  handles: [\"w\", \"e\"].map(type),\n  input: function input(x, e) {\n    return x == null ? null : [[+x[0], e[0][1]], [+x[1], e[1][1]]];\n  },\n  output: function output(xy) {\n    return xy && [xy[0][0], xy[1][0]];\n  }\n};\nvar Y = {\n  name: \"y\",\n  handles: [\"n\", \"s\"].map(type),\n  input: function input(y, e) {\n    return y == null ? null : [[e[0][0], +y[0]], [e[1][0], +y[1]]];\n  },\n  output: function output(xy) {\n    return xy && [xy[0][1], xy[1][1]];\n  }\n};\nvar XY = {\n  name: \"xy\",\n  handles: [\"n\", \"w\", \"e\", \"s\", \"nw\", \"ne\", \"sw\", \"se\"].map(type),\n  input: function input(xy) {\n    return xy == null ? null : number2(xy);\n  },\n  output: function output(xy) {\n    return xy;\n  }\n};\nvar cursors = {\n  overlay: \"crosshair\",\n  selection: \"move\",\n  n: \"ns-resize\",\n  e: \"ew-resize\",\n  s: \"ns-resize\",\n  w: \"ew-resize\",\n  nw: \"nwse-resize\",\n  ne: \"nesw-resize\",\n  se: \"nwse-resize\",\n  sw: \"nesw-resize\"\n};\nvar flipX = {\n  e: \"w\",\n  w: \"e\",\n  nw: \"ne\",\n  ne: \"nw\",\n  se: \"sw\",\n  sw: \"se\"\n};\nvar flipY = {\n  n: \"s\",\n  s: \"n\",\n  nw: \"sw\",\n  ne: \"se\",\n  se: \"ne\",\n  sw: \"nw\"\n};\nvar signsX = {\n  overlay: +1,\n  selection: +1,\n  n: null,\n  e: +1,\n  s: null,\n  w: -1,\n  nw: -1,\n  ne: +1,\n  se: +1,\n  sw: -1\n};\nvar signsY = {\n  overlay: +1,\n  selection: +1,\n  n: -1,\n  e: null,\n  s: +1,\n  w: null,\n  nw: -1,\n  ne: -1,\n  se: +1,\n  sw: +1\n};\n\nfunction type(t) {\n  return {\n    type: t\n  };\n} // Ignore right-click, since that should open the context menu.\n\n\nfunction defaultFilter(event) {\n  return !event.ctrlKey && !event.button;\n}\n\nfunction defaultExtent() {\n  var svg = this.ownerSVGElement || this;\n\n  if (svg.hasAttribute(\"viewBox\")) {\n    svg = svg.viewBox.baseVal;\n    return [[svg.x, svg.y], [svg.x + svg.width, svg.y + svg.height]];\n  }\n\n  return [[0, 0], [svg.width.baseVal.value, svg.height.baseVal.value]];\n}\n\nfunction defaultTouchable() {\n  return navigator.maxTouchPoints || \"ontouchstart\" in this;\n} // Like d3.local, but with the name “__brush” rather than auto-generated.\n\n\nfunction local(node) {\n  while (!node.__brush) {\n    if (!(node = node.parentNode)) return;\n  }\n\n  return node.__brush;\n}\n\nfunction empty(extent) {\n  return extent[0][0] === extent[1][0] || extent[0][1] === extent[1][1];\n}\n\nexport function brushSelection(node) {\n  var state = node.__brush;\n  return state ? state.dim.output(state.selection) : null;\n}\nexport function brushX() {\n  return brush(X);\n}\nexport function brushY() {\n  return brush(Y);\n}\nexport default function () {\n  return brush(XY);\n}\n\nfunction brush(dim) {\n  var extent = defaultExtent,\n      filter = defaultFilter,\n      touchable = defaultTouchable,\n      keys = true,\n      listeners = dispatch(\"start\", \"brush\", \"end\"),\n      handleSize = 6,\n      touchending;\n\n  function brush(group) {\n    var overlay = group.property(\"__brush\", initialize).selectAll(\".overlay\").data([type(\"overlay\")]);\n    overlay.enter().append(\"rect\").attr(\"class\", \"overlay\").attr(\"pointer-events\", \"all\").attr(\"cursor\", cursors.overlay).merge(overlay).each(function () {\n      var extent = local(this).extent;\n      select(this).attr(\"x\", extent[0][0]).attr(\"y\", extent[0][1]).attr(\"width\", extent[1][0] - extent[0][0]).attr(\"height\", extent[1][1] - extent[0][1]);\n    });\n    group.selectAll(\".selection\").data([type(\"selection\")]).enter().append(\"rect\").attr(\"class\", \"selection\").attr(\"cursor\", cursors.selection).attr(\"fill\", \"#777\").attr(\"fill-opacity\", 0.3).attr(\"stroke\", \"#fff\").attr(\"shape-rendering\", \"crispEdges\");\n    var handle = group.selectAll(\".handle\").data(dim.handles, function (d) {\n      return d.type;\n    });\n    handle.exit().remove();\n    handle.enter().append(\"rect\").attr(\"class\", function (d) {\n      return \"handle handle--\" + d.type;\n    }).attr(\"cursor\", function (d) {\n      return cursors[d.type];\n    });\n    group.each(redraw).attr(\"fill\", \"none\").attr(\"pointer-events\", \"all\").on(\"mousedown.brush\", started).filter(touchable).on(\"touchstart.brush\", started).on(\"touchmove.brush\", touchmoved).on(\"touchend.brush touchcancel.brush\", touchended).style(\"touch-action\", \"none\").style(\"-webkit-tap-highlight-color\", \"rgba(0,0,0,0)\");\n  }\n\n  brush.move = function (group, selection, event) {\n    if (group.tween) {\n      group.on(\"start.brush\", function (event) {\n        emitter(this, arguments).beforestart().start(event);\n      }).on(\"interrupt.brush end.brush\", function (event) {\n        emitter(this, arguments).end(event);\n      }).tween(\"brush\", function () {\n        var that = this,\n            state = that.__brush,\n            emit = emitter(that, arguments),\n            selection0 = state.selection,\n            selection1 = dim.input(typeof selection === \"function\" ? selection.apply(this, arguments) : selection, state.extent),\n            i = interpolate(selection0, selection1);\n\n        function tween(t) {\n          state.selection = t === 1 && selection1 === null ? null : i(t);\n          redraw.call(that);\n          emit.brush();\n        }\n\n        return selection0 !== null && selection1 !== null ? tween : tween(1);\n      });\n    } else {\n      group.each(function () {\n        var that = this,\n            args = arguments,\n            state = that.__brush,\n            selection1 = dim.input(typeof selection === \"function\" ? selection.apply(that, args) : selection, state.extent),\n            emit = emitter(that, args).beforestart();\n        interrupt(that);\n        state.selection = selection1 === null ? null : selection1;\n        redraw.call(that);\n        emit.start(event).brush(event).end(event);\n      });\n    }\n  };\n\n  brush.clear = function (group, event) {\n    brush.move(group, null, event);\n  };\n\n  function redraw() {\n    var group = select(this),\n        selection = local(this).selection;\n\n    if (selection) {\n      group.selectAll(\".selection\").style(\"display\", null).attr(\"x\", selection[0][0]).attr(\"y\", selection[0][1]).attr(\"width\", selection[1][0] - selection[0][0]).attr(\"height\", selection[1][1] - selection[0][1]);\n      group.selectAll(\".handle\").style(\"display\", null).attr(\"x\", function (d) {\n        return d.type[d.type.length - 1] === \"e\" ? selection[1][0] - handleSize / 2 : selection[0][0] - handleSize / 2;\n      }).attr(\"y\", function (d) {\n        return d.type[0] === \"s\" ? selection[1][1] - handleSize / 2 : selection[0][1] - handleSize / 2;\n      }).attr(\"width\", function (d) {\n        return d.type === \"n\" || d.type === \"s\" ? selection[1][0] - selection[0][0] + handleSize : handleSize;\n      }).attr(\"height\", function (d) {\n        return d.type === \"e\" || d.type === \"w\" ? selection[1][1] - selection[0][1] + handleSize : handleSize;\n      });\n    } else {\n      group.selectAll(\".selection,.handle\").style(\"display\", \"none\").attr(\"x\", null).attr(\"y\", null).attr(\"width\", null).attr(\"height\", null);\n    }\n  }\n\n  function emitter(that, args, clean) {\n    var emit = that.__brush.emitter;\n    return emit && (!clean || !emit.clean) ? emit : new Emitter(that, args, clean);\n  }\n\n  function Emitter(that, args, clean) {\n    this.that = that;\n    this.args = args;\n    this.state = that.__brush;\n    this.active = 0;\n    this.clean = clean;\n  }\n\n  Emitter.prototype = {\n    beforestart: function beforestart() {\n      if (++this.active === 1) this.state.emitter = this, this.starting = true;\n      return this;\n    },\n    start: function start(event, mode) {\n      if (this.starting) this.starting = false, this.emit(\"start\", event, mode);else this.emit(\"brush\", event);\n      return this;\n    },\n    brush: function brush(event, mode) {\n      this.emit(\"brush\", event, mode);\n      return this;\n    },\n    end: function end(event, mode) {\n      if (--this.active === 0) delete this.state.emitter, this.emit(\"end\", event, mode);\n      return this;\n    },\n    emit: function emit(type, event, mode) {\n      var d = select(this.that).datum();\n      listeners.call(type, this.that, new BrushEvent(type, {\n        sourceEvent: event,\n        target: brush,\n        selection: dim.output(this.state.selection),\n        mode: mode,\n        dispatch: listeners\n      }), d);\n    }\n  };\n\n  function started(event) {\n    if (touchending && !event.touches) return;\n    if (!filter.apply(this, arguments)) return;\n    var that = this,\n        type = event.target.__data__.type,\n        mode = (keys && event.metaKey ? type = \"overlay\" : type) === \"selection\" ? MODE_DRAG : keys && event.altKey ? MODE_CENTER : MODE_HANDLE,\n        signX = dim === Y ? null : signsX[type],\n        signY = dim === X ? null : signsY[type],\n        state = local(that),\n        extent = state.extent,\n        selection = state.selection,\n        W = extent[0][0],\n        w0,\n        w1,\n        N = extent[0][1],\n        n0,\n        n1,\n        E = extent[1][0],\n        e0,\n        e1,\n        S = extent[1][1],\n        s0,\n        s1,\n        dx = 0,\n        dy = 0,\n        moving,\n        shifting = signX && signY && keys && event.shiftKey,\n        lockX,\n        lockY,\n        points = Array.from(event.touches || [event], function (t) {\n      var i = t.identifier;\n      t = pointer(t, that);\n      t.point0 = t.slice();\n      t.identifier = i;\n      return t;\n    });\n    interrupt(that);\n    var emit = emitter(that, arguments, true).beforestart();\n\n    if (type === \"overlay\") {\n      if (selection) moving = true;\n      var pts = [points[0], points[1] || points[0]];\n      state.selection = selection = [[w0 = dim === Y ? W : min(pts[0][0], pts[1][0]), n0 = dim === X ? N : min(pts[0][1], pts[1][1])], [e0 = dim === Y ? E : max(pts[0][0], pts[1][0]), s0 = dim === X ? S : max(pts[0][1], pts[1][1])]];\n      if (points.length > 1) move(event);\n    } else {\n      w0 = selection[0][0];\n      n0 = selection[0][1];\n      e0 = selection[1][0];\n      s0 = selection[1][1];\n    }\n\n    w1 = w0;\n    n1 = n0;\n    e1 = e0;\n    s1 = s0;\n    var group = select(that).attr(\"pointer-events\", \"none\");\n    var overlay = group.selectAll(\".overlay\").attr(\"cursor\", cursors[type]);\n\n    if (event.touches) {\n      emit.moved = moved;\n      emit.ended = ended;\n    } else {\n      var view = select(event.view).on(\"mousemove.brush\", moved, true).on(\"mouseup.brush\", ended, true);\n      if (keys) view.on(\"keydown.brush\", keydowned, true).on(\"keyup.brush\", keyupped, true);\n      dragDisable(event.view);\n    }\n\n    redraw.call(that);\n    emit.start(event, mode.name);\n\n    function moved(event) {\n      var _iterator = _createForOfIteratorHelper(event.changedTouches || [event]),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var p = _step.value;\n\n          var _iterator3 = _createForOfIteratorHelper(points),\n              _step3;\n\n          try {\n            for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n              var d = _step3.value;\n              if (d.identifier === p.identifier) d.cur = pointer(p, that);\n            }\n          } catch (err) {\n            _iterator3.e(err);\n          } finally {\n            _iterator3.f();\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      if (shifting && !lockX && !lockY && points.length === 1) {\n        var point = points[0];\n        if (abs(point.cur[0] - point[0]) > abs(point.cur[1] - point[1])) lockY = true;else lockX = true;\n      }\n\n      var _iterator2 = _createForOfIteratorHelper(points),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var _point = _step2.value;\n          if (_point.cur) _point[0] = _point.cur[0], _point[1] = _point.cur[1];\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n\n      moving = true;\n      noevent(event);\n      move(event);\n    }\n\n    function move(event) {\n      var point = points[0],\n          point0 = point.point0;\n      var t;\n      dx = point[0] - point0[0];\n      dy = point[1] - point0[1];\n\n      switch (mode) {\n        case MODE_SPACE:\n        case MODE_DRAG:\n          {\n            if (signX) dx = max(W - w0, min(E - e0, dx)), w1 = w0 + dx, e1 = e0 + dx;\n            if (signY) dy = max(N - n0, min(S - s0, dy)), n1 = n0 + dy, s1 = s0 + dy;\n            break;\n          }\n\n        case MODE_HANDLE:\n          {\n            if (points[1]) {\n              if (signX) w1 = max(W, min(E, points[0][0])), e1 = max(W, min(E, points[1][0])), signX = 1;\n              if (signY) n1 = max(N, min(S, points[0][1])), s1 = max(N, min(S, points[1][1])), signY = 1;\n            } else {\n              if (signX < 0) dx = max(W - w0, min(E - w0, dx)), w1 = w0 + dx, e1 = e0;else if (signX > 0) dx = max(W - e0, min(E - e0, dx)), w1 = w0, e1 = e0 + dx;\n              if (signY < 0) dy = max(N - n0, min(S - n0, dy)), n1 = n0 + dy, s1 = s0;else if (signY > 0) dy = max(N - s0, min(S - s0, dy)), n1 = n0, s1 = s0 + dy;\n            }\n\n            break;\n          }\n\n        case MODE_CENTER:\n          {\n            if (signX) w1 = max(W, min(E, w0 - dx * signX)), e1 = max(W, min(E, e0 + dx * signX));\n            if (signY) n1 = max(N, min(S, n0 - dy * signY)), s1 = max(N, min(S, s0 + dy * signY));\n            break;\n          }\n      }\n\n      if (e1 < w1) {\n        signX *= -1;\n        t = w0, w0 = e0, e0 = t;\n        t = w1, w1 = e1, e1 = t;\n        if (type in flipX) overlay.attr(\"cursor\", cursors[type = flipX[type]]);\n      }\n\n      if (s1 < n1) {\n        signY *= -1;\n        t = n0, n0 = s0, s0 = t;\n        t = n1, n1 = s1, s1 = t;\n        if (type in flipY) overlay.attr(\"cursor\", cursors[type = flipY[type]]);\n      }\n\n      if (state.selection) selection = state.selection; // May be set by brush.move!\n\n      if (lockX) w1 = selection[0][0], e1 = selection[1][0];\n      if (lockY) n1 = selection[0][1], s1 = selection[1][1];\n\n      if (selection[0][0] !== w1 || selection[0][1] !== n1 || selection[1][0] !== e1 || selection[1][1] !== s1) {\n        state.selection = [[w1, n1], [e1, s1]];\n        redraw.call(that);\n        emit.brush(event, mode.name);\n      }\n    }\n\n    function ended(event) {\n      nopropagation(event);\n\n      if (event.touches) {\n        if (event.touches.length) return;\n        if (touchending) clearTimeout(touchending);\n        touchending = setTimeout(function () {\n          touchending = null;\n        }, 500); // Ghost clicks are delayed!\n      } else {\n        dragEnable(event.view, moving);\n        view.on(\"keydown.brush keyup.brush mousemove.brush mouseup.brush\", null);\n      }\n\n      group.attr(\"pointer-events\", \"all\");\n      overlay.attr(\"cursor\", cursors.overlay);\n      if (state.selection) selection = state.selection; // May be set by brush.move (on start)!\n\n      if (empty(selection)) state.selection = null, redraw.call(that);\n      emit.end(event, mode.name);\n    }\n\n    function keydowned(event) {\n      switch (event.keyCode) {\n        case 16:\n          {\n            // SHIFT\n            shifting = signX && signY;\n            break;\n          }\n\n        case 18:\n          {\n            // ALT\n            if (mode === MODE_HANDLE) {\n              if (signX) e0 = e1 - dx * signX, w0 = w1 + dx * signX;\n              if (signY) s0 = s1 - dy * signY, n0 = n1 + dy * signY;\n              mode = MODE_CENTER;\n              move(event);\n            }\n\n            break;\n          }\n\n        case 32:\n          {\n            // SPACE; takes priority over ALT\n            if (mode === MODE_HANDLE || mode === MODE_CENTER) {\n              if (signX < 0) e0 = e1 - dx;else if (signX > 0) w0 = w1 - dx;\n              if (signY < 0) s0 = s1 - dy;else if (signY > 0) n0 = n1 - dy;\n              mode = MODE_SPACE;\n              overlay.attr(\"cursor\", cursors.selection);\n              move(event);\n            }\n\n            break;\n          }\n\n        default:\n          return;\n      }\n\n      noevent(event);\n    }\n\n    function keyupped(event) {\n      switch (event.keyCode) {\n        case 16:\n          {\n            // SHIFT\n            if (shifting) {\n              lockX = lockY = shifting = false;\n              move(event);\n            }\n\n            break;\n          }\n\n        case 18:\n          {\n            // ALT\n            if (mode === MODE_CENTER) {\n              if (signX < 0) e0 = e1;else if (signX > 0) w0 = w1;\n              if (signY < 0) s0 = s1;else if (signY > 0) n0 = n1;\n              mode = MODE_HANDLE;\n              move(event);\n            }\n\n            break;\n          }\n\n        case 32:\n          {\n            // SPACE\n            if (mode === MODE_SPACE) {\n              if (event.altKey) {\n                if (signX) e0 = e1 - dx * signX, w0 = w1 + dx * signX;\n                if (signY) s0 = s1 - dy * signY, n0 = n1 + dy * signY;\n                mode = MODE_CENTER;\n              } else {\n                if (signX < 0) e0 = e1;else if (signX > 0) w0 = w1;\n                if (signY < 0) s0 = s1;else if (signY > 0) n0 = n1;\n                mode = MODE_HANDLE;\n              }\n\n              overlay.attr(\"cursor\", cursors[type]);\n              move(event);\n            }\n\n            break;\n          }\n\n        default:\n          return;\n      }\n\n      noevent(event);\n    }\n  }\n\n  function touchmoved(event) {\n    emitter(this, arguments).moved(event);\n  }\n\n  function touchended(event) {\n    emitter(this, arguments).ended(event);\n  }\n\n  function initialize() {\n    var state = this.__brush || {\n      selection: null\n    };\n    state.extent = number2(extent.apply(this, arguments));\n    state.dim = dim;\n    return state;\n  }\n\n  brush.extent = function (_) {\n    return arguments.length ? (extent = typeof _ === \"function\" ? _ : constant(number2(_)), brush) : extent;\n  };\n\n  brush.filter = function (_) {\n    return arguments.length ? (filter = typeof _ === \"function\" ? _ : constant(!!_), brush) : filter;\n  };\n\n  brush.touchable = function (_) {\n    return arguments.length ? (touchable = typeof _ === \"function\" ? _ : constant(!!_), brush) : touchable;\n  };\n\n  brush.handleSize = function (_) {\n    return arguments.length ? (handleSize = +_, brush) : handleSize;\n  };\n\n  brush.keyModifiers = function (_) {\n    return arguments.length ? (keys = !!_, brush) : keys;\n  };\n\n  brush.on = function () {\n    var value = listeners.on.apply(listeners, arguments);\n    return value === listeners ? brush : value;\n  };\n\n  return brush;\n}","map":{"version":3,"sources":["/Users/davidmunechika/Documents/Code/Research/visual-auditor/node_modules/d3-brush/src/brush.js"],"names":["dispatch","dragDisable","dragEnable","interpolate","pointer","select","interrupt","constant","BrushEvent","noevent","nopropagation","MODE_DRAG","name","MODE_SPACE","MODE_HANDLE","MODE_CENTER","abs","Math","max","min","number1","e","number2","X","handles","map","type","input","x","output","xy","Y","y","XY","cursors","overlay","selection","n","s","w","nw","ne","se","sw","flipX","flipY","signsX","signsY","t","defaultFilter","event","ctrlKey","button","defaultExtent","svg","ownerSVGElement","hasAttribute","viewBox","baseVal","width","height","value","defaultTouchable","navigator","maxTouchPoints","local","node","__brush","parentNode","empty","extent","brushSelection","state","dim","brushX","brush","brushY","filter","touchable","keys","listeners","handleSize","touchending","group","property","initialize","selectAll","data","enter","append","attr","merge","each","handle","d","exit","remove","redraw","on","started","touchmoved","touchended","style","move","tween","emitter","arguments","beforestart","start","end","that","emit","selection0","selection1","apply","i","call","args","clear","length","clean","Emitter","active","prototype","starting","mode","datum","sourceEvent","target","touches","__data__","metaKey","altKey","signX","signY","W","w0","w1","N","n0","n1","E","e0","e1","S","s0","s1","dx","dy","moving","shifting","shiftKey","lockX","lockY","points","Array","from","identifier","point0","slice","pts","moved","ended","view","keydowned","keyupped","changedTouches","p","cur","point","clearTimeout","setTimeout","keyCode","_","keyModifiers"],"mappings":"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","sourcesContent":["import {dispatch} from \"d3-dispatch\";\nimport {dragDisable, dragEnable} from \"d3-drag\";\nimport {interpolate} from \"d3-interpolate\";\nimport {pointer, select} from \"d3-selection\";\nimport {interrupt} from \"d3-transition\";\nimport constant from \"./constant.js\";\nimport BrushEvent from \"./event.js\";\nimport noevent, {nopropagation} from \"./noevent.js\";\n\nvar MODE_DRAG = {name: \"drag\"},\n    MODE_SPACE = {name: \"space\"},\n    MODE_HANDLE = {name: \"handle\"},\n    MODE_CENTER = {name: \"center\"};\n\nconst {abs, max, min} = Math;\n\nfunction number1(e) {\n  return [+e[0], +e[1]];\n}\n\nfunction number2(e) {\n  return [number1(e[0]), number1(e[1])];\n}\n\nvar X = {\n  name: \"x\",\n  handles: [\"w\", \"e\"].map(type),\n  input: function(x, e) { return x == null ? null : [[+x[0], e[0][1]], [+x[1], e[1][1]]]; },\n  output: function(xy) { return xy && [xy[0][0], xy[1][0]]; }\n};\n\nvar Y = {\n  name: \"y\",\n  handles: [\"n\", \"s\"].map(type),\n  input: function(y, e) { return y == null ? null : [[e[0][0], +y[0]], [e[1][0], +y[1]]]; },\n  output: function(xy) { return xy && [xy[0][1], xy[1][1]]; }\n};\n\nvar XY = {\n  name: \"xy\",\n  handles: [\"n\", \"w\", \"e\", \"s\", \"nw\", \"ne\", \"sw\", \"se\"].map(type),\n  input: function(xy) { return xy == null ? null : number2(xy); },\n  output: function(xy) { return xy; }\n};\n\nvar cursors = {\n  overlay: \"crosshair\",\n  selection: \"move\",\n  n: \"ns-resize\",\n  e: \"ew-resize\",\n  s: \"ns-resize\",\n  w: \"ew-resize\",\n  nw: \"nwse-resize\",\n  ne: \"nesw-resize\",\n  se: \"nwse-resize\",\n  sw: \"nesw-resize\"\n};\n\nvar flipX = {\n  e: \"w\",\n  w: \"e\",\n  nw: \"ne\",\n  ne: \"nw\",\n  se: \"sw\",\n  sw: \"se\"\n};\n\nvar flipY = {\n  n: \"s\",\n  s: \"n\",\n  nw: \"sw\",\n  ne: \"se\",\n  se: \"ne\",\n  sw: \"nw\"\n};\n\nvar signsX = {\n  overlay: +1,\n  selection: +1,\n  n: null,\n  e: +1,\n  s: null,\n  w: -1,\n  nw: -1,\n  ne: +1,\n  se: +1,\n  sw: -1\n};\n\nvar signsY = {\n  overlay: +1,\n  selection: +1,\n  n: -1,\n  e: null,\n  s: +1,\n  w: null,\n  nw: -1,\n  ne: -1,\n  se: +1,\n  sw: +1\n};\n\nfunction type(t) {\n  return {type: t};\n}\n\n// Ignore right-click, since that should open the context menu.\nfunction defaultFilter(event) {\n  return !event.ctrlKey && !event.button;\n}\n\nfunction defaultExtent() {\n  var svg = this.ownerSVGElement || this;\n  if (svg.hasAttribute(\"viewBox\")) {\n    svg = svg.viewBox.baseVal;\n    return [[svg.x, svg.y], [svg.x + svg.width, svg.y + svg.height]];\n  }\n  return [[0, 0], [svg.width.baseVal.value, svg.height.baseVal.value]];\n}\n\nfunction defaultTouchable() {\n  return navigator.maxTouchPoints || (\"ontouchstart\" in this);\n}\n\n// Like d3.local, but with the name “__brush” rather than auto-generated.\nfunction local(node) {\n  while (!node.__brush) if (!(node = node.parentNode)) return;\n  return node.__brush;\n}\n\nfunction empty(extent) {\n  return extent[0][0] === extent[1][0]\n      || extent[0][1] === extent[1][1];\n}\n\nexport function brushSelection(node) {\n  var state = node.__brush;\n  return state ? state.dim.output(state.selection) : null;\n}\n\nexport function brushX() {\n  return brush(X);\n}\n\nexport function brushY() {\n  return brush(Y);\n}\n\nexport default function() {\n  return brush(XY);\n}\n\nfunction brush(dim) {\n  var extent = defaultExtent,\n      filter = defaultFilter,\n      touchable = defaultTouchable,\n      keys = true,\n      listeners = dispatch(\"start\", \"brush\", \"end\"),\n      handleSize = 6,\n      touchending;\n\n  function brush(group) {\n    var overlay = group\n        .property(\"__brush\", initialize)\n      .selectAll(\".overlay\")\n      .data([type(\"overlay\")]);\n\n    overlay.enter().append(\"rect\")\n        .attr(\"class\", \"overlay\")\n        .attr(\"pointer-events\", \"all\")\n        .attr(\"cursor\", cursors.overlay)\n      .merge(overlay)\n        .each(function() {\n          var extent = local(this).extent;\n          select(this)\n              .attr(\"x\", extent[0][0])\n              .attr(\"y\", extent[0][1])\n              .attr(\"width\", extent[1][0] - extent[0][0])\n              .attr(\"height\", extent[1][1] - extent[0][1]);\n        });\n\n    group.selectAll(\".selection\")\n      .data([type(\"selection\")])\n      .enter().append(\"rect\")\n        .attr(\"class\", \"selection\")\n        .attr(\"cursor\", cursors.selection)\n        .attr(\"fill\", \"#777\")\n        .attr(\"fill-opacity\", 0.3)\n        .attr(\"stroke\", \"#fff\")\n        .attr(\"shape-rendering\", \"crispEdges\");\n\n    var handle = group.selectAll(\".handle\")\n      .data(dim.handles, function(d) { return d.type; });\n\n    handle.exit().remove();\n\n    handle.enter().append(\"rect\")\n        .attr(\"class\", function(d) { return \"handle handle--\" + d.type; })\n        .attr(\"cursor\", function(d) { return cursors[d.type]; });\n\n    group\n        .each(redraw)\n        .attr(\"fill\", \"none\")\n        .attr(\"pointer-events\", \"all\")\n        .on(\"mousedown.brush\", started)\n      .filter(touchable)\n        .on(\"touchstart.brush\", started)\n        .on(\"touchmove.brush\", touchmoved)\n        .on(\"touchend.brush touchcancel.brush\", touchended)\n        .style(\"touch-action\", \"none\")\n        .style(\"-webkit-tap-highlight-color\", \"rgba(0,0,0,0)\");\n  }\n\n  brush.move = function(group, selection, event) {\n    if (group.tween) {\n      group\n          .on(\"start.brush\", function(event) { emitter(this, arguments).beforestart().start(event); })\n          .on(\"interrupt.brush end.brush\", function(event) { emitter(this, arguments).end(event); })\n          .tween(\"brush\", function() {\n            var that = this,\n                state = that.__brush,\n                emit = emitter(that, arguments),\n                selection0 = state.selection,\n                selection1 = dim.input(typeof selection === \"function\" ? selection.apply(this, arguments) : selection, state.extent),\n                i = interpolate(selection0, selection1);\n\n            function tween(t) {\n              state.selection = t === 1 && selection1 === null ? null : i(t);\n              redraw.call(that);\n              emit.brush();\n            }\n\n            return selection0 !== null && selection1 !== null ? tween : tween(1);\n          });\n    } else {\n      group\n          .each(function() {\n            var that = this,\n                args = arguments,\n                state = that.__brush,\n                selection1 = dim.input(typeof selection === \"function\" ? selection.apply(that, args) : selection, state.extent),\n                emit = emitter(that, args).beforestart();\n\n            interrupt(that);\n            state.selection = selection1 === null ? null : selection1;\n            redraw.call(that);\n            emit.start(event).brush(event).end(event);\n          });\n    }\n  };\n\n  brush.clear = function(group, event) {\n    brush.move(group, null, event);\n  };\n\n  function redraw() {\n    var group = select(this),\n        selection = local(this).selection;\n\n    if (selection) {\n      group.selectAll(\".selection\")\n          .style(\"display\", null)\n          .attr(\"x\", selection[0][0])\n          .attr(\"y\", selection[0][1])\n          .attr(\"width\", selection[1][0] - selection[0][0])\n          .attr(\"height\", selection[1][1] - selection[0][1]);\n\n      group.selectAll(\".handle\")\n          .style(\"display\", null)\n          .attr(\"x\", function(d) { return d.type[d.type.length - 1] === \"e\" ? selection[1][0] - handleSize / 2 : selection[0][0] - handleSize / 2; })\n          .attr(\"y\", function(d) { return d.type[0] === \"s\" ? selection[1][1] - handleSize / 2 : selection[0][1] - handleSize / 2; })\n          .attr(\"width\", function(d) { return d.type === \"n\" || d.type === \"s\" ? selection[1][0] - selection[0][0] + handleSize : handleSize; })\n          .attr(\"height\", function(d) { return d.type === \"e\" || d.type === \"w\" ? selection[1][1] - selection[0][1] + handleSize : handleSize; });\n    }\n\n    else {\n      group.selectAll(\".selection,.handle\")\n          .style(\"display\", \"none\")\n          .attr(\"x\", null)\n          .attr(\"y\", null)\n          .attr(\"width\", null)\n          .attr(\"height\", null);\n    }\n  }\n\n  function emitter(that, args, clean) {\n    var emit = that.__brush.emitter;\n    return emit && (!clean || !emit.clean) ? emit : new Emitter(that, args, clean);\n  }\n\n  function Emitter(that, args, clean) {\n    this.that = that;\n    this.args = args;\n    this.state = that.__brush;\n    this.active = 0;\n    this.clean = clean;\n  }\n\n  Emitter.prototype = {\n    beforestart: function() {\n      if (++this.active === 1) this.state.emitter = this, this.starting = true;\n      return this;\n    },\n    start: function(event, mode) {\n      if (this.starting) this.starting = false, this.emit(\"start\", event, mode);\n      else this.emit(\"brush\", event);\n      return this;\n    },\n    brush: function(event, mode) {\n      this.emit(\"brush\", event, mode);\n      return this;\n    },\n    end: function(event, mode) {\n      if (--this.active === 0) delete this.state.emitter, this.emit(\"end\", event, mode);\n      return this;\n    },\n    emit: function(type, event, mode) {\n      var d = select(this.that).datum();\n      listeners.call(\n        type,\n        this.that,\n        new BrushEvent(type, {\n          sourceEvent: event,\n          target: brush,\n          selection: dim.output(this.state.selection),\n          mode,\n          dispatch: listeners\n        }),\n        d\n      );\n    }\n  };\n\n  function started(event) {\n    if (touchending && !event.touches) return;\n    if (!filter.apply(this, arguments)) return;\n\n    var that = this,\n        type = event.target.__data__.type,\n        mode = (keys && event.metaKey ? type = \"overlay\" : type) === \"selection\" ? MODE_DRAG : (keys && event.altKey ? MODE_CENTER : MODE_HANDLE),\n        signX = dim === Y ? null : signsX[type],\n        signY = dim === X ? null : signsY[type],\n        state = local(that),\n        extent = state.extent,\n        selection = state.selection,\n        W = extent[0][0], w0, w1,\n        N = extent[0][1], n0, n1,\n        E = extent[1][0], e0, e1,\n        S = extent[1][1], s0, s1,\n        dx = 0,\n        dy = 0,\n        moving,\n        shifting = signX && signY && keys && event.shiftKey,\n        lockX,\n        lockY,\n        points = Array.from(event.touches || [event], t => {\n          const i = t.identifier;\n          t = pointer(t, that);\n          t.point0 = t.slice();\n          t.identifier = i;\n          return t;\n        });\n\n    interrupt(that);\n    var emit = emitter(that, arguments, true).beforestart();\n\n    if (type === \"overlay\") {\n      if (selection) moving = true;\n      const pts = [points[0], points[1] || points[0]];\n      state.selection = selection = [[\n          w0 = dim === Y ? W : min(pts[0][0], pts[1][0]),\n          n0 = dim === X ? N : min(pts[0][1], pts[1][1])\n        ], [\n          e0 = dim === Y ? E : max(pts[0][0], pts[1][0]),\n          s0 = dim === X ? S : max(pts[0][1], pts[1][1])\n        ]];\n      if (points.length > 1) move(event);\n    } else {\n      w0 = selection[0][0];\n      n0 = selection[0][1];\n      e0 = selection[1][0];\n      s0 = selection[1][1];\n    }\n\n    w1 = w0;\n    n1 = n0;\n    e1 = e0;\n    s1 = s0;\n\n    var group = select(that)\n        .attr(\"pointer-events\", \"none\");\n\n    var overlay = group.selectAll(\".overlay\")\n        .attr(\"cursor\", cursors[type]);\n\n    if (event.touches) {\n      emit.moved = moved;\n      emit.ended = ended;\n    } else {\n      var view = select(event.view)\n          .on(\"mousemove.brush\", moved, true)\n          .on(\"mouseup.brush\", ended, true);\n      if (keys) view\n          .on(\"keydown.brush\", keydowned, true)\n          .on(\"keyup.brush\", keyupped, true)\n\n      dragDisable(event.view);\n    }\n\n    redraw.call(that);\n    emit.start(event, mode.name);\n\n    function moved(event) {\n      for (const p of event.changedTouches || [event]) {\n        for (const d of points)\n          if (d.identifier === p.identifier) d.cur = pointer(p, that);\n      }\n      if (shifting && !lockX && !lockY && points.length === 1) {\n        const point = points[0];\n        if (abs(point.cur[0] - point[0]) > abs(point.cur[1] - point[1]))\n          lockY = true;\n        else\n          lockX = true;\n      }\n      for (const point of points)\n        if (point.cur) point[0] = point.cur[0], point[1] = point.cur[1];\n      moving = true;\n      noevent(event);\n      move(event);\n    }\n\n    function move(event) {\n      const point = points[0], point0 = point.point0;\n      var t;\n\n      dx = point[0] - point0[0];\n      dy = point[1] - point0[1];\n\n      switch (mode) {\n        case MODE_SPACE:\n        case MODE_DRAG: {\n          if (signX) dx = max(W - w0, min(E - e0, dx)), w1 = w0 + dx, e1 = e0 + dx;\n          if (signY) dy = max(N - n0, min(S - s0, dy)), n1 = n0 + dy, s1 = s0 + dy;\n          break;\n        }\n        case MODE_HANDLE: {\n          if (points[1]) {\n            if (signX) w1 = max(W, min(E, points[0][0])), e1 = max(W, min(E, points[1][0])), signX = 1;\n            if (signY) n1 = max(N, min(S, points[0][1])), s1 = max(N, min(S, points[1][1])), signY = 1;\n          } else {\n            if (signX < 0) dx = max(W - w0, min(E - w0, dx)), w1 = w0 + dx, e1 = e0;\n            else if (signX > 0) dx = max(W - e0, min(E - e0, dx)), w1 = w0, e1 = e0 + dx;\n            if (signY < 0) dy = max(N - n0, min(S - n0, dy)), n1 = n0 + dy, s1 = s0;\n            else if (signY > 0) dy = max(N - s0, min(S - s0, dy)), n1 = n0, s1 = s0 + dy;\n          }\n          break;\n        }\n        case MODE_CENTER: {\n          if (signX) w1 = max(W, min(E, w0 - dx * signX)), e1 = max(W, min(E, e0 + dx * signX));\n          if (signY) n1 = max(N, min(S, n0 - dy * signY)), s1 = max(N, min(S, s0 + dy * signY));\n          break;\n        }\n      }\n\n      if (e1 < w1) {\n        signX *= -1;\n        t = w0, w0 = e0, e0 = t;\n        t = w1, w1 = e1, e1 = t;\n        if (type in flipX) overlay.attr(\"cursor\", cursors[type = flipX[type]]);\n      }\n\n      if (s1 < n1) {\n        signY *= -1;\n        t = n0, n0 = s0, s0 = t;\n        t = n1, n1 = s1, s1 = t;\n        if (type in flipY) overlay.attr(\"cursor\", cursors[type = flipY[type]]);\n      }\n\n      if (state.selection) selection = state.selection; // May be set by brush.move!\n      if (lockX) w1 = selection[0][0], e1 = selection[1][0];\n      if (lockY) n1 = selection[0][1], s1 = selection[1][1];\n\n      if (selection[0][0] !== w1\n          || selection[0][1] !== n1\n          || selection[1][0] !== e1\n          || selection[1][1] !== s1) {\n        state.selection = [[w1, n1], [e1, s1]];\n        redraw.call(that);\n        emit.brush(event, mode.name);\n      }\n    }\n\n    function ended(event) {\n      nopropagation(event);\n      if (event.touches) {\n        if (event.touches.length) return;\n        if (touchending) clearTimeout(touchending);\n        touchending = setTimeout(function() { touchending = null; }, 500); // Ghost clicks are delayed!\n      } else {\n        dragEnable(event.view, moving);\n        view.on(\"keydown.brush keyup.brush mousemove.brush mouseup.brush\", null);\n      }\n      group.attr(\"pointer-events\", \"all\");\n      overlay.attr(\"cursor\", cursors.overlay);\n      if (state.selection) selection = state.selection; // May be set by brush.move (on start)!\n      if (empty(selection)) state.selection = null, redraw.call(that);\n      emit.end(event, mode.name);\n    }\n\n    function keydowned(event) {\n      switch (event.keyCode) {\n        case 16: { // SHIFT\n          shifting = signX && signY;\n          break;\n        }\n        case 18: { // ALT\n          if (mode === MODE_HANDLE) {\n            if (signX) e0 = e1 - dx * signX, w0 = w1 + dx * signX;\n            if (signY) s0 = s1 - dy * signY, n0 = n1 + dy * signY;\n            mode = MODE_CENTER;\n            move(event);\n          }\n          break;\n        }\n        case 32: { // SPACE; takes priority over ALT\n          if (mode === MODE_HANDLE || mode === MODE_CENTER) {\n            if (signX < 0) e0 = e1 - dx; else if (signX > 0) w0 = w1 - dx;\n            if (signY < 0) s0 = s1 - dy; else if (signY > 0) n0 = n1 - dy;\n            mode = MODE_SPACE;\n            overlay.attr(\"cursor\", cursors.selection);\n            move(event);\n          }\n          break;\n        }\n        default: return;\n      }\n      noevent(event);\n    }\n\n    function keyupped(event) {\n      switch (event.keyCode) {\n        case 16: { // SHIFT\n          if (shifting) {\n            lockX = lockY = shifting = false;\n            move(event);\n          }\n          break;\n        }\n        case 18: { // ALT\n          if (mode === MODE_CENTER) {\n            if (signX < 0) e0 = e1; else if (signX > 0) w0 = w1;\n            if (signY < 0) s0 = s1; else if (signY > 0) n0 = n1;\n            mode = MODE_HANDLE;\n            move(event);\n          }\n          break;\n        }\n        case 32: { // SPACE\n          if (mode === MODE_SPACE) {\n            if (event.altKey) {\n              if (signX) e0 = e1 - dx * signX, w0 = w1 + dx * signX;\n              if (signY) s0 = s1 - dy * signY, n0 = n1 + dy * signY;\n              mode = MODE_CENTER;\n            } else {\n              if (signX < 0) e0 = e1; else if (signX > 0) w0 = w1;\n              if (signY < 0) s0 = s1; else if (signY > 0) n0 = n1;\n              mode = MODE_HANDLE;\n            }\n            overlay.attr(\"cursor\", cursors[type]);\n            move(event);\n          }\n          break;\n        }\n        default: return;\n      }\n      noevent(event);\n    }\n  }\n\n  function touchmoved(event) {\n    emitter(this, arguments).moved(event);\n  }\n\n  function touchended(event) {\n    emitter(this, arguments).ended(event);\n  }\n\n  function initialize() {\n    var state = this.__brush || {selection: null};\n    state.extent = number2(extent.apply(this, arguments));\n    state.dim = dim;\n    return state;\n  }\n\n  brush.extent = function(_) {\n    return arguments.length ? (extent = typeof _ === \"function\" ? _ : constant(number2(_)), brush) : extent;\n  };\n\n  brush.filter = function(_) {\n    return arguments.length ? (filter = typeof _ === \"function\" ? _ : constant(!!_), brush) : filter;\n  };\n\n  brush.touchable = function(_) {\n    return arguments.length ? (touchable = typeof _ === \"function\" ? _ : constant(!!_), brush) : touchable;\n  };\n\n  brush.handleSize = function(_) {\n    return arguments.length ? (handleSize = +_, brush) : handleSize;\n  };\n\n  brush.keyModifiers = function(_) {\n    return arguments.length ? (keys = !!_, brush) : keys;\n  };\n\n  brush.on = function() {\n    var value = listeners.on.apply(listeners, arguments);\n    return value === listeners ? brush : value;\n  };\n\n  return brush;\n}\n"]},"metadata":{},"sourceType":"module"}